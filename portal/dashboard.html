<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Worker Dashboard</title>
</head>
<body>
    <div class="container">
        <h2>Your Assignment</h2>
        <div id="jobCard" class="card" style="display:none;">
            <p><strong>Job ID:</strong> <span id="jobId"></span></p>
            <p><strong>Location:</strong> <span id="jobLoc"></span></p>
            <button onclick="goToChecklist()" style="background:#33B26E;">Open Daily Checklist</button>
        </div>
        <div id="noJob" style="display:none; text-align:center;">
            <p>No active assignment found for this email.</p>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzQT7DP6beojo_8pcOP3VFPcsBhvxI1nUYxbUQvThdnWuMvw8InEogp2TwoKS9RQ_M5/exec';
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get('email');

        async function loadJob() {
            // This calls a 'get' action in your script to find the worker's row
            const res = await fetch(`${scriptURL}?action=getWorkerJob&email=${encodeURIComponent(email)}`);
            const data = await res.json();

            if (data.jobId) {
                document.getElementById('jobId').innerText = data.jobId;
                document.getElementById('jobLoc').innerText = data.address;
                document.getElementById('jobCard').style.display = 'block';
            } else {
                document.getElementById('noJob').style.display = 'block';
            }
        }

        function goToChecklist() {
            window.location.href = `../checklist/index.html?email=${encodeURIComponent(email)}`;
        }

        if(email) loadJob();
    </script>
</body>
</html>
