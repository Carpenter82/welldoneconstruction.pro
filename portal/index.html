<script>
    function checkStatus() {
        const emailInput = document.getElementById('portalEmail').value.trim().toLowerCase();
        
        // UPDATE THIS URL with your latest Deployment URL
        const scriptURL = "https://script.google.com/macros/s/AKfycbx6xrCNODgRVfAsrA-i5PWqjqZm1klel8RhM_Zh_DbID8nQHkMNd-Rhwp14ya5js7WZ2w/exec?id=" + encodeURIComponent(emailInput);

        const badge = document.getElementById('statusBadge');
        badge.innerText = "Accessing Records...";

        fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('portalContent').style.display = 'block';
            document.getElementById('welcomeName').innerText = "Account: " + emailInput;
            
            if(data.isVerified) {
                badge.innerText = "✓ VERIFIED";
                badge.className = "status-badge verified";
            } else {
                badge.innerText = "⚠ VERIFICATION PENDING";
                badge.className = "status-badge pending";
            }
        })
        .catch(err => {
            console.error(err);
            alert("Connection Error. Is the Master Engine Deployed to 'Anyone'?");
        });
    }
</script>
