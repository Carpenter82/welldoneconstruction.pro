<style>
  body { font-family: sans-serif; padding: 20px; }
  .badge { padding: 10px 15px; border-radius: 5px; color: white; font-weight: bold; display: inline-block; }
  .status-active { background-color: #28a745; } /* Green */
  .status-pending { background-color: #ff8c00; } /* Orange */
  .container { max-width: 600px; margin: auto; border: 1px solid #ddd; padding: 20px; border-radius: 10px; }
</style>

<div class="container">
  <h1 id="welcomeHeading">Loading Portal...</h1>
  <p>Employment Status: <span id="statusBadge" class="badge status-pending">Checking...</span></p>
  
  <div id="portalContent" style="display:none;">
    <hr>
    <h3>On-Call Roster Active</h3>
    <p>You are officially verified. Please keep your phone nearby for job notifications.</p>
    </div>
  <div id="portalContent" style="display:none;">
    <hr>
    <h3>On-Call Roster Active</h3>
    <a href="../checklist/index.html" id="checklistLink" class="btn">Go to Site Checklist</a>
</div>

<script>
    // Inside your loadPortal() function, after you get the worker data:
    const email = new URLSearchParams(window.location.search).get('email');
    document.getElementById('checklistLink').href = `../checklist/index.html?email=${email}`;
</script>
</div>

<script>
  async function loadPortal() {
    const urlParams = new URLSearchParams(window.location.search);
    const email = urlParams.get('email');

    if (!email) {
      window.location.href = '../index.html';
      return;
    }

    try {
      // UPDATED TO YOUR NEW PRODUCTION URL
      const response = await fetch(`https://script.google.com/macros/s/AKfycbx3JdShPWsv2leCEdh7Q7ebzbu3HZHXSGJgG3wgeKf7r2vvE-3YKKzHIiEmdTmIRZKg/exec?email=${encodeURIComponent(email)}`);
      const worker = await response.json();

      if (worker.status === 'Not Found') {
        alert('Profile not found. Please complete intake.');
        window.location.href = '../index.html';
      } else {
        // UI Updates
        document.getElementById('welcomeHeading').innerText = `Welcome, ${worker.firstName}`;
        
        const badge = document.getElementById('statusBadge');
        badge.innerText = worker.status;

        // Change badge color to Green if they are fully active
        if (worker.status.includes('ACTIVE')) {
          badge.classList.remove('status-pending');
          badge.classList.add('status-active');
          document.getElementById('portalContent').style.display = 'block';
        }
      }
    } catch (err) {
      console.error("Portal Load Error:", err);
      document.getElementById('welcomeHeading').innerText = "Connection Error";
    }
  }

  window.onload = loadPortal;
</script>
