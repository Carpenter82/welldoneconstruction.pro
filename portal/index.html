<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: 'Helvetica', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; color: #1c1e21; }
    .section-label { font-size: 12px; font-weight: bold; color: #65676b; text-transform: uppercase; margin-bottom: 10px; }
    
    /* 1. HEADER STYLE */
    .header-box { background: #fff; padding: 20px; border-radius: 4px; border: 1px solid #ddd; margin-bottom: 20px; }
    .header-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .stat { font-size: 14px; } .stat b { color: #000; }

    /* 2. TIMELINE STYLE */
    .job-card { background: #fff; padding: 15px; border-radius: 4px; border: 1px solid #ddd; margin-bottom: 15px; position: relative; }
    .job-card.issue { border-left: 5px solid #d93025; }
    .job-card.clean { border-left: 5px solid #188038; }
    .links { margin-top: 10px; }
    .btn { display: inline-block; padding: 6px 12px; background: #eee; border: 1px solid #ccc; text-decoration: none; color: #333; font-size: 12px; margin-right: 5px; border-radius: 2px; }

    /* 3. ISSUES LOG STYLE */
    .log-box { background: #333; color: #fff; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 13px; line-height: 1.6; }
    .log-entry { border-bottom: 1px solid #555; padding: 5px 0; }
    .timestamp { color: #888; font-size: 11px; }
    .flag { color: #ff4d4d; font-weight: bold; }
  </style>
</head>
<body>

  <div class="section-label">1. Staff Record: No Bio / No Opinions</div>
  <div class="header-box">
    <div class="header-grid">
      <div class="stat">NAME/ID: <b><?= profile.name ?> / <?= profile.id ?></b></div>
      <div class="stat">TRADE: <b><?= profile.trade ?></b></div>
      <div class="stat">STATUS: <b><?= profile.status ?></b></div>
      <div class="stat">TRUST LEVEL: <b><?= profile.trust ?></b></div>
    </div>
  </div>

  <div class="section-label">3. Immutable Issues Log (Evidence)</div>
  <div class="log-box">
    <? jobs.forEach(function(job) { 
        job.tasks.forEach(function(task) { 
          if(!task.done) { ?>
            <div class="log-entry">
              <span class="timestamp">[<?= job.submittedAt ?>]</span> 
              <span class="flag">✖ <?= task.taskName.toUpperCase() ?>:</span> REQUIRED REWORK AT <?= job.jobName ?>
            </div>
    <?    } 
        }); 
      }); ?>
    <? if (jobs.every(j => j.tasks.every(t => t.done))) { ?>
      <div style="color:#888;">> NO ISSUES RECORDED</div>
    <? } ?>
  </div>

  <br>

  <div class="section-label">2. Job History Timeline</div>
  <? jobs.forEach(function(job) { 
      var hasIssue = job.tasks.some(t => !t.done);
  ?>
    <div class="job-card <?= hasIssue ? 'issue' : 'clean' ?>">
      <div style="float:right; font-size: 12px; color: #777;"><?= job.submittedAt ?></div>
      <b><?= job.jobName ?></b><br>
      
      <div style="margin: 10px 0;">
        <?= hasIssue ? '<span style="color:#d93025;">✖ Issues Flagged</span>' : '<span style="color:#188038;">✔ Checklist Completed</span>' ?>
        <br>
        <span>Payment Status: <b><?= job.paymentStatus || 'Held' ?></b></span>
      </div>

      <div class="links">
        <a href="<?= job.pdfLink ?>" class="btn" target="_blank">PDF Checklist</a>
        <a href="<?= job.photoLink ?>" class="btn" target="_blank">Photo Folder</a>
      </div>
    </div>
  <? }); ?>

</body>
</html>
