<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="apple-touch-icon" href="https://welldoneconstruction.link/wp-content/uploads/2025/11/well-done-construction-favicon.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Well Done</title>
  <link rel="stylesheet" href="../styles.css">
  <style>
    .split-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
    .badge-new { background: #fff3e0; color: #ef6c00; } /* NEW / DOCS UPLOADED */
    .badge-hired { background: #e8f5e9; color: #2e7d32; } /* ACTIVE */
    @media (max-width: 800px) { .split-grid { grid-template-columns: 1fr; } }
    .card { position: relative; border-left: 5px solid #ccc; }
    .card.active-status { border-left-color: var(--accent); }
  </style>
</head>
<body>

<div class="container" style="max-width: 1000px;">
  <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>Admin Command Center</h2>
    <div>
      <a href="project.html" class="btn" style="padding: 10px 15px; text-decoration: none; font-size: 14px;">+ Register Project</a>
    </div>
  </header>

  <div class="split-grid">
    <section>
      <h3 style="border-bottom: 2px solid var(--accent); padding-bottom: 10px;">Applicants (Intake)</h3>
      <div id="applicantList">Loading Applicants...</div>
    </section>

    <section>
      <h3 style="border-bottom: 2px solid var(--primary); padding-bottom: 10px;">Master Roster (Settings)</h3>
      <div id="crewList">Loading Roster...</div>
    </section>
  </div>
</div>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzQT7DP6beojo_8pcOP3VFPcsBhvxI1nUYxbUQvThdnWuMvw8InEogp2TwoKS9RQ_M5/exec';

  async function loadDashboard() {
    try {
      const response = await fetch(scriptURL + "?action=getDashboard");
      const data = await response.json();

      // Render Applicants (From 'application' sheet)
      const appContainer = document.getElementById('applicantList');
      appContainer.innerHTML = data.applicants.length ? data.applicants.map(a => `
        <div class="card">
          <span class="badge badge-new">${a.status}</span>
          <p><strong>${a.name}</strong><br>${a.trade}</p>
          <button onclick="hireWorker('${a.email}')" style="padding: 8px; font-size: 11px; background:#33B26E;">HIRE TO ROSTER</button>
        </div>
      `).join('') : '<p>No pending applications.</p>';

      // Render Crew (From 'Settings' sheet)
      const crewContainer = document.getElementById('crewList');
      crewContainer.innerHTML = data.activeCrew.length ? data.activeCrew.map(c => `
        <div class="card active-status">
          <span class="badge badge-hired">${c.status}</span>
          <p><strong>${c.name}</strong><br>${c.trade} | ${c.tier}</p>
          <div style="display:flex; gap:5px;">
             <button onclick="window.open('${c.folder}')" style="padding: 8px; font-size: 11px; background: #343E47;">VIEW VAULT</button>
             <button onclick="assignJob('${c.email}')" style="padding: 8px; font-size: 11px; background: var(--primary);">ASSIGN JOB</button>
          </div>
        </div>
      `).join('') : '<p>No workers in Master Roster.</p>';

    } catch (err) {
      document.getElementById('applicantList').innerText = "Error syncing with Sheets.";
    }
  }

  async function hireWorker(email) {
    if(!confirm("Move worker to Master Roster (Settings)?")) return;
    await fetch(scriptURL, { method: 'POST', body: JSON.stringify({ action: 'hireWorker', email: email }) });
    alert("Worker Activated in Settings!");
    loadDashboard();
  }

  async function assignJob(email) {
    const jobId = prompt("Enter JOB ID from ProjectLog to assign to this worker:");
    if(!jobId) return;
    await fetch(scriptURL, { method: 'POST', body: JSON.stringify({ action: 'assignToRoster', email: email, jobId: jobId }) });
    alert("Worker Assigned to Job!");
    loadDashboard();
  }

  window.onload = loadDashboard;
</script>
  // Render Crew (Updated with Status Check)
const crewContainer = document.getElementById('crewList');
crewContainer.innerHTML = data.activeCrew.length ? data.activeCrew.map(c => `
  <div class="card active-status">
    <span class="badge ${c.jobStatus === 'Accepted' ? 'badge-hired' : 'badge-new'}">${c.jobStatus || 'No Active Job'}</span>
    <p><strong>${c.name}</strong><br>${c.trade} | ${c.tier}</p>
    <div style="display:flex; gap:5px;">
       <button onclick="window.open('${c.folder}')" style="background: #343E47;">VAULT</button>
       <button onclick="assignJob('${c.email}')" style="background: var(--primary);">SEND WO</button>
    </div>
  </div>
`).join('') : '<p>No workers in Master Roster.</p>';

</body>
</html>
