<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WD Admin Control</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: #fff; text-align: center; padding: 20px; }
        .container { max-width: 450px; margin: auto; border: 1px solid #333; padding: 20px; border-radius: 15px; background: #111; }
        .btn { display: block; background: #ffd700; color: #000; padding: 18px; margin: 15px 0; text-decoration: none; font-weight: bold; border-radius: 10px; font-size: 18px; }
        .worker-link { display: flex; justify-content: space-between; background: #222; padding: 15px; margin: 5px 0; border-radius: 8px; text-decoration: none; color: #fff; border: 1px solid #333; }
        h2 { color: #ffd700; margin-bottom: 5px; }
        .loader { color: #888; font-style: italic; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h2>WELL DONE</h2>
        <p>CONSTRUCTION ADMIN</p>
        <a href="https://welldoneconstruction.pro/employee-packet" class="btn">HIRE NEW WORKER</a>
        
        <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
        <p style="text-align: left; color: #888;">WORKER DIRECTORY</p>
        <div id="workerList" class="loader">Loading workers...</div>
    </div>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbyHFv2lI2whyM63Y3Up_yqeI006GVOpVCgzQUDD8DvWXjdGVvqSkfCvL8wb8Ud8RIaG/exec";

        // Fetch the list of workers automatically
        // Fetch the list with a "No-Cache" rule to force it to be fresh
    fetch(scriptURL + "?get=list", { cache: "no-store" })
        .then(res => res.json())
        .then(names => {
            const listDiv = document.getElementById('workerList');
            if (names.length === 0) {
                listDiv.innerHTML = "No workers found yet.";
            } else {
                listDiv.innerHTML = ""; // Clear loader
                names.forEach(name => {
                    const id = name.replace(/\s+/g, '_');
                    listDiv.innerHTML += `
                        <a href="${scriptURL}?id=${id}" target="_blank" class="worker-link">
                            <span>${name}</span>
                            <span style="color: #ffd700;">VIEW â†’</span>
                        </a>`;
                });
            }
        })
        .catch(err => {
            document.getElementById('workerList').innerHTML = "Connection Error. Check Permissions.";
            console.error(err);
        });
    </script>
</body>
</html>
